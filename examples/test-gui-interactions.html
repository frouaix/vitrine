<!DOCTYPE html>
<html>
<head>
  <title>GUI Interaction Test</title>
  <script type="module">
    import { ImmediateRenderer } from 'vitrine';
    import {
      button,
      checkbox,
      radiobutton,
      vstack,
      panel,
      transformGUIControl,
      lightTheme
    } from 'vitrine';

    const canvas = document.getElementById('canvas');
    const renderer = new ImmediateRenderer(canvas);
    const log = document.getElementById('log');

    function addLog(message) {
      const entry = document.createElement('div');
      entry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
    }

    // State
    const state = {
      checkboxChecked: false,
      radioValue: 'option1',
      buttonClickCount: 0
    };

    function render() {
      const context = { theme: lightTheme };
      
      const gui = panel(
        { x: 50, y: 50, dx: 400, dy: 400, stTitle: 'Interaction Test', duPadding: 25 },
        [
          vstack(
            { duSpacing: 25 },
            [
              checkbox({
                stLabel: 'Test Checkbox (click me!)',
                fChecked: state.checkboxChecked,
                onChange: (fChecked) => {
                  state.checkboxChecked = fChecked;
                  addLog(`Checkbox changed to: ${fChecked}`);
                  render();
                }
              }),
              radiobutton({
                stLabel: 'Option 1',
                stValue: 'option1',
                fChecked: state.radioValue === 'option1',
                onChange: (val) => {
                  state.radioValue = val;
                  addLog(`Radio changed to: ${val}`);
                  render();
                }
              }),
              radiobutton({
                stLabel: 'Option 2',
                stValue: 'option2',
                fChecked: state.radioValue === 'option2',
                onChange: (val) => {
                  state.radioValue = val;
                  addLog(`Radio changed to: ${val}`);
                  render();
                }
              }),
              button({
                stLabel: `Click Me! (${state.buttonClickCount})`,
                variant: 'primary',
                dx: 350,
                dy: 50,
                onClick: () => {
                  state.buttonClickCount++;
                  addLog(`Button clicked! Count: ${state.buttonClickCount}`);
                  render();
                }
              })
            ]
          )
        ]
      );

      const blocks = transformGUIControl(gui, context);
      renderer.clear();
      renderer.render(blocks);
    }

    // Initial render
    addLog('Page loaded - try clicking controls!');
    render();

    // Handle resize
    window.addEventListener('resize', () => {
      renderer.resize();
      render();
    });
  </script>
  <style>
    body { margin: 0; padding: 20px; font-family: system-ui; background: #1a1a1a; color: white; }
    #canvas { border: 1px solid #444; display: block; margin-bottom: 20px; }
    #log { 
      background: #2a2a2a; 
      padding: 15px; 
      border-radius: 8px; 
      max-height: 200px; 
      overflow-y: auto;
      font-size: 14px;
    }
    #log div { margin: 5px 0; }
  </style>
</head>
<body>
  <h1>GUI Controls Interaction Test</h1>
  <canvas id="canvas" width="500" height="500"></canvas>
  <h2>Event Log:</h2>
  <div id="log"></div>
</body>
</html>
